{% extends "base_table.html" %}
{% load i18n %}
{% load staticfiles %}
{% load be_rpt_extras %}

{% block title %}
Alchip version list
{% endblock %}

{% block bc %}
<breadcrumb>
  <breadcrumb-item><a href="{% url 'be_rpt:proj_list' %}" title="go to projects list">{{proj_name}}</a></breadcrumb-item>
  <breadcrumb-item><a href="{% url 'be_rpt:block_list' proj_name %}" title="go to blocks list">{{block_name}}</a></breadcrumb-item>
  <breadcrumb-item>versions</breadcrumb-item>
</breadcrumb>
{% endblock %}

{% block js_table %}
<script>
 var db_col_ary = [
   {
     title: "Version Name",
     key: "version_name",
     /* "fixed": "left",*/
     width: 200,
     sortable: true,
     render: (h, params) => {
       const row = params.row;
       const text = row.version_name
       return h("a", {
         attrs: {
           href: "{% url 'be_rpt:version_detail' proj_name block_name 'djst_var' %}".replace("djst_var", text)
         }
       }, text);
     }
   },
   {% for version_head in version_head_lst %}
   {% if version_head|to_lu == "status" %}
   {
     title: "Status",
     key: "{{version_head|to_lu}}",
     width: 150,
     sortable: true,
     render: (h, params) => {
       const row = params.row;
       const color = row.status === "running" ? "yellow" : row.status === "passed" ? "green" : "red";
       const text = row.status
       return h("Tag", {
         props: {
           type: "dot",
           color: color
         }
       }, text);
     }
   },
   {% else %}
   {
     title: "{{ version_head }}",
     key: "{{ version_head|to_lu }}",
     width: 200,
     sortable: true,
     {% if version_head|to_lu == "prop2" %}
     filters: [
       {
         label: "value is available",
         value: 1
       },
       {
         label: "value is NA",
         value: 2
       }
     ],
     filterMultiple: false,
     filterMethod (value, row) {
       if (value === 1) {
         return row.{{version_head|to_lu}} !== "None";
       } else if (value === 2) {
         return row.{{version_head|to_lu}} === "None";
       }
     }
     {% endif %}
   },
   {% endif %}
   {% endfor %}
 ];

 var db_data_ary = [
   {% for version in object_list %}
   {
     version_name: "{{ version.name }}",
     {% for version_head in version_head_lst %}
     {{ version_head|to_lu }}: "{{ version.data|get_value:version_head|safe }}",
     {% endfor %}
     {% for version_key, version_value in version.data.items %}
     {% if version_key|to_lu not in version_head_lst %}
     {{version_key|to_lu}}: "{{version_value}}"
     {% endif %}
     {% endfor %}
   },
   {% endfor %}
 ];
</script>
{% endblock %}
